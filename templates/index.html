<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DermaScan AI Detection</title>

    <style>
        body { 
            font-family: sans-serif; 
            margin: 0; 
            padding: 20px; 
            background-color: #f8fcfc; 
            color: #333;
            position: relative;
            min-height: 100vh;
        }
        .container { 
            max-width: 900px; 
            margin: auto; 
            padding: 30px; 
            background-color: white; 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .header { text-align: center; margin-bottom: 40px; }
        .header h1 { font-size: 2.3em; margin: 0; }
        .top-nav {
            position: absolute;
            top: 20px;
            right: 20px;
        }
        .nav-icon { 
            margin-left: 10px; 
            color: #333; 
            text-decoration: none; 
            font-weight: bold; 
        }
        .nav-icon:hover { color: #1e88e5; }
        .logout-btn { color: #d9534f; }
        .logout-btn:hover { color: #b52b27; }

        .btn-primary { 
            background-color: #1e88e5; 
            color: white; 
            padding: 12px 25px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 1.1em; 
        }
        .btn-primary:hover { background-color: #1565c0; }

        .input-group { text-align: center; margin-bottom: 25px; }
        .condition-tag {
            display: inline-block;
            background-color: #e3f2fd;
            color: #1e88e5;
            padding: 6px 14px;
            border-radius: 20px;
            margin: 6px;
        }

        #results-container {
            display: none;
            margin-top: 20px;
            border: 1px solid #ddd;
            padding: 18px;
            border-radius: 8px;
        }
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed #ccc;
        }
        .result-item:last-child { border-bottom: none; }
        .confidence-score { font-weight: bold; color: #4caf50; }

        .loading {
            display: none;
            text-align: center;
            color: #1e88e5;
            margin-top: 15px;
        }
    </style>
</head>

<body>

    <!-- TOP NAV -->
    <div class="top-nav">
        <a href="/" class="nav-icon">&#x2302; Home</a>
        <a href="/logout" class="nav-icon logout-btn">&#x21AA; Logout</a>
    </div>

    <!-- MAIN CONTAINER -->
    <div class="container">

        <div class="header">
            <h1 style="color: #4CAF50;">DermaScan</h1>
            <h1>AI Skin Disease Detection Platform</h1>
            <p>Upload a skin image and get instant AI-powered analysis.</p>
        </div>

        <!-- IMAGE UPLOAD -->
        <div class="input-group">
            <input type="file" id="image-upload" accept="image/*" style="display:none;">
            <button class="btn-primary" onclick="document.getElementById('image-upload').click();">&#x2191; Start Analysis</button>
            <p id="file-name-display" style="margin-top: 10px; color: #555;">No file selected.</p>
        </div>

        <div id="loading" class="loading">
            <p>Analyzing image... Please wait.</p>
        </div>

        <!-- RESULTS -->
        <div id="results-container">
            <h3>AI Analysis Results</h3>
            <div id="analysis-list"></div>
            <p style="margin-top: 12px; font-size: 0.9em; color:#777;">
                *This is an AI prediction and should not replace professional medical advice.
            </p>
        </div>

        <!-- CONDITIONS LIST -->
        <div class="detectable-conditions">
            <h3>Detectable Conditions</h3>
            {% for condition in conditions %}
                <span class="condition-tag">{{ condition }}</span>
            {% endfor %}
        </div>

    </div>

    <!-- SCRIPT -->
    <script>
        document.getElementById('image-upload').addEventListener('change', function(event) {

            const file = event.target.files[0];
            const fileNameDisplay = document.getElementById('file-name-display');
            const resultsContainer = document.getElementById('results-container');
            const analysisList = document.getElementById('analysis-list');
            const loading = document.getElementById('loading');

            if (!file) {
                fileNameDisplay.textContent = "No file selected.";
                return;
            }

            // Update UI
            fileNameDisplay.textContent = `Selected File: ${file.name}`;
            resultsContainer.style.display = 'none';
            analysisList.innerHTML = '';
            loading.style.display = 'block';

            // Prepare form data
            const formData = new FormData();
            formData.append('file', file);   // CORRECT KEY

            // Send to backend
            fetch('/api/analyze', {          // CORRECT ENDPOINT
                method: 'POST',
                body: formData
            })
            .then(res => res.json())
            .then(data => {
                loading.style.display = 'none';

                if (data.error) {
                    analysisList.innerHTML = `<p style="color:red;">${data.error}</p>`;
                } else {
                    analysisList.innerHTML = `
                        <div class="result-item">
                            <span>${data.prediction}</span>
                            <span class="confidence-score">${data.confidence}%</span>
                        </div>
                    `;
                }

                resultsContainer.style.display = 'block';
            })
            .catch(err => {
                loading.style.display = 'none';
                analysisList.innerHTML = `<p style="color:red;">Network Error: Could not connect to server.</p>`;
                resultsContainer.style.display = 'block';
                console.error(err);
            });
        });
    </script>

</body>
</html>
